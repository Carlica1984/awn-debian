#!/usr/bin/make -f
#DH_VERBOSE=1

include /usr/share/quilt/quilt.make

PYVERS=$(shell pyversions -vs)

configure_flags += \
			--prefix=/usr \
			--disable-pymod-checks \
			--with-desktop=gnome \
			--with-gconf \
			--enable-gtk-doc \
			--with-gconf-schema-file-dir=/etc/gconf/schemas \
			LDFLAGS="-Wl,-z,defs -Wl,--as-needed"

build-%/configure-stamp: patch
	dh_testdir
	mkdir -p build-$*
	cd build-$* && \
		PYTHON=/usr/bin/python$* CFLAGS="$(CFLAGS)" \
			$(CURDIR)/configure $(configure_flags)
	touch $@

build-%/build-stamp: build-%/configure-stamp
	dh_testdir
	$(MAKE) -C build-$*
	touch $@

build: $(PYVERS:%=build-%/build-stamp)

clean: unpatch
	dh_testdir
	dh_testroot
	rm -rf build-* debian/tmp-*
	dh_clean

install-clean:
	dh_testdir
	dh_testroot
	dh_clean -k

install-%: install-clean build-%/build-stamp
	dh_testdir
	dh_testroot
	GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 \
	$(MAKE) -C build-$* install DESTDIR=$(CURDIR)/debian/tmp-$*
	dh_install --sourcedir=debian/tmp-$*

install: $(PYVERS:%=install-%)
	dh_installdirs

binary-arch: build install
	dh_strip --dbg-package=libawn0-dbg
	dh binary-arch

binary-indep: build install
	dh binary-indep

binary: binary-arch binary-indep

#DEB_DH_INSTALL_SOURCEDIR=debian/tmp

#include /usr/share/cdbs/1/rules/debhelper.mk
#include /usr/share/cdbs/1/class/gnome.mk
#include /usr/share/cdbs/1/rules/simple-patchsys.mk
#
#DEB_CONFIGURE_EXTRA_FLAGS += 	--disable-pymod-checks \
#				--with-desktop=gnome \
#				--with-gconf \
#				--enable-gtk-doc
#
#DEB_CONFIGURE_SCRIPT_ENV += LDFLAGS="-Wl,-z,defs -Wl,--as-needed"
#
#DEB_INSTALL_MANPAGES_avant-window-navigator := debian/avant-window-navigator.1 debian/awn-applet-activation.1 debian/awn-autostart.1
#DEB_INSTALL_MANPAGES_awn-manager := debian/awn-manager.1 debian/awn-launcher-editor.1 debian/awn-schema-to-gconf.1 debian/awn-applets-migration.1

#DEB_DH_MAKESHLIBS_ARGS_libawn0 += -V"libawn0 (>= 0.3~bzr489)"
#DEB_DH_MAKESHLIBS_ARGS_avant-window-navigator += -n
#DEB_SHLIBDEPS_LIBRARY_avant-window-navigator:= libawn0
#DEB_SHLIBDEPS_INCLUDE_avant-window-navigator := debian/libawn0/usr/
#DEB_DH_STRIP_ARGS := --dbg-package=libawn0-dbg

#install/avant-window-navigator::
#	dh_install -pavant-window-navigator --sourcedir=debian/tmp
#	mv debian/tmp/usr/bin/avant-window-navigator debian/avant-window-navigator/usr/bin/awn
#	cp debian/awn.wrapper debian/avant-window-navigator/usr/bin/avant-window-navigator
#
#
#binary-install/awn-manager::
#	dh_pysupport -pawn-manager
#
#binary-install/python-awn::
#	dh_pysupport -ppython-awn
#!/usr/bin/make -f
#DH_VERBOSE=1
